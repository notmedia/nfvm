#!/usr/bin/env node

'use strict';

const caporal = require('caporal');
const chalk = require('chalk');

const pkg = require('../package.json');
const { Manager } = require('../lib/API');

caporal.version(pkg.version);

caporal.command('init')
  .description('create local .nfvmrc.json config file')
  .action(() => {
    try {
      Manager.initialize();
    } catch (err) {
      console.log(chalk.red(err));
    }
  });

caporal.command('create')
  .argument('<packname>')
  .option('-f, --file <filename>', 'create file')
  .option('-v <version>', 'version of pack or file')
  .option('-g, --global')
  .action(async (args, options) => {
    try {
      const manager = new Manager(true, options.global);

      if (options.file) {
        await manager.createFile(args.packname, options.file, options.v, options.folder);
      } else {
        await manager.createPack(args.packname, options.v, options.folder);
      }
    } catch (err) {
      console.log(chalk.red(err));
    }
  });

caporal.command('remove')
  .argument('<packname>')
  .option('-f, --file <filename>', 'remove file')
  .option('-v <version>', 'version of pack or file')
  .option('-g, --global')
  .action(async (args, options) => {
    try {
      const manager = new Manager(true, options.global);

      if (options.file) {
        manager.removeFile(args.packname, options.file, options.v);
      } else {
        await manager.removePack(args.packname, options.v);
      }
    } catch (err) {
      console.log(chalk.red(err));
    }
  });

caporal.command('set')
  .argument('<packname>')
  .argument('<version>')
  .option('-g, --global')
  .action(async (args, options) => {
    const manager = new Manager(true, options.global);

    manager.set(args.packname, args.version)
      .catch((err) => {
        console.log(chalk.red(err));
      });
  });

caporal.command('list')
  .option('-p, --pack <packname>')
  .option('-g, --global')
  .action((args, options) => {
    const manager = new Manager(true, options.global);

    manager.list(options.pack)
      .catch((err) => {
        console.log(chalk.red(err));
      });
  });

caporal.parse(process.argv);
