#!/usr/bin/env node

'use strict';

const caporal = require('caporal');
const chalk = require('chalk');

const pkg = require('../package.json');
const { Manager } = require('../lib/API');

caporal.version(pkg.version);

caporal.command('init')
  .description('create local .nfvmrc.json config file')
  .action(() => {
    try {
      Manager.initialize();
    } catch (err) {
      console.log(chalk.red(err));
    }
  });

caporal.command('create')
  .argument('<name>')
  .option('-p, --pack', 'create pack')
  .option('-f, --file', 'create file')
  .option('-v <version>', 'version of pack or file')
  .option('--folder <path>', 'create from folder')
  .option('-g, --global')
  .action((args, options) => {
    try {
      const manager = new Manager(true, options.global);

      if (options.pack) {
        manager.createPack(args.name, options.version, options.folder);
      } else if (options.file) {
        manager.createFile(args.name, options.version);
      } else {
        throw new Error('Options -p or -f must be specified');
      }
    } catch (err) {
      console.log(chalk.red(err));
    }
  });

caporal.command('remove')
  .argument('<name>')
  .option('-p, --pack', 'remove pack')
  .option('-f, --file', 'remove file')
  .option('-v <version>', 'version of pack or file')
  .option('-g, --global')
  .action((args, options) => {
    try {
      const manager = new Manager(true, options.global);

      if (options.pack) {
        manager.removePack(args.name, options.version, options.folder);
      } else if (options.file) {
        manager.removeFile(args.name, options.version);
      } else {
        throw new Error('Options -p or -f must be specified');
      }
    } catch (err) {
      console.log(chalk.red(err));
    }
  });

caporal.command('set')
  .argument('<pack>')
  .argument('<version>')
  .option('-g, --global')
  .action((args, options) => {

  });

caporal.command('list')
  .option('-p, --pack <pack>')
  .option('-g, --global')
  .action((args, options) => {
    try {
      const manager = new Manager(true, options.global);

      manager.list(options.pack);
    } catch (err) {
      console.log(chalk.red(err));
    }
  });

caporal.parse(process.argv);
